name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build binary
      run: |
        pyinstaller --onefile --name drive-master --console --clean mount_drive.py
    
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: dist/drive-master
        body: |
          ## ðŸš€ Drive Master Release
          
          ### Installation
          ```bash
          # One-line install
          curl -sSL https://raw.githubusercontent.com/supposious-spec/drive-master/main/universal-install.sh | bash
          
          # Or download binary directly
          wget https://github.com/supposious-spec/drive-master/releases/download/${{ github.ref_name }}/drive-master
          chmod +x drive-master
          sudo mv drive-master /usr/local/bin/
          ```
          
          ### Usage
          ```bash
          drive-master              # Interactive menu
          drive-master MyDrive      # Mount specific drive
          drive-master --version    # Show version
          ```
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}